<section class = "flex justify-center items-center min-h-screen w-full p-4">
  <p-toast position = "top-right"></p-toast>

  <!-- Main Card Container -->
  <div class = "w-full max-w-4xl">
    <p-card
      [style] = "{ 'width': '100%' }"
      styleClass = "shadow-5"
    >
      <!-- Header with Profile Image -->
      <ng-template pTemplate = "header">
        <div class = "flex justify-center bg-gray-100 p-4">
          <p-image
            [src] = "user.photo"
            alt = "Profile photo of {{ user.name }}"
            width = "300"
            height = "300"
            [preview] = "true"
            imageClass = "border-circle shadow-3"
            [imageStyle] = "{ 'object-fit': 'cover' }"
          />
        </div>
      </ng-template>

      <!-- Title Section -->
      <ng-template pTemplate = "title">
        <div class = "flex align-items-center gap-3">
          <i class = "pi pi-user text-3xl pt-2"></i>
          <span class = "text-2xl font-bold">{{ user.name }}</span>
        </div>
      </ng-template>

      <!-- Subtitle Section -->
      <ng-template pTemplate = "subtitle">
        <div class = "flex align-items-center gap-3">
          <i class = "pi pi-envelope text-3xl pt-2"></i>
          <a
            href = "mailto:{{ user.email }}"
            class = "text-primary no-underline hover:underline text-xl"
          >
            {{ user.email }}
          </a>
        </div>
      </ng-template>

      <!-- Content Grid -->
      <div class = "grid">
        <div class = "col-12 md:col-6 p-4 border-bottom-1 surface-border">
          <div class = "text-600 font-medium text-lg">ID</div>
          <div class = "text-900 text-lg">{{ user._id }}</div>
        </div>
        <div class = "col-12 md:col-6 p-4 border-bottom-1 surface-border">
          <div class = "text-600 font-medium text-lg">Date of Birth</div>
          <div class = "text-900 text-lg">{{ user.dateOfBirth | date:'mediumDate' }}</div>
        </div>
        <div class = "col-12 md:col-6 p-4 border-bottom-1 surface-border">
          <div class = "text-600 font-medium text-lg">Gender</div>
          <div class = "text-900 text-lg">{{ user.gender | titlecase }}</div>
        </div>
        <div class = "col-12 md:col-6 p-4 border-bottom-1 surface-border">
          <div class = "text-600 font-medium text-lg">Last Password Change</div>
          <div class = "text-900 text-lg">{{ user.passwordChangedAt | date:'medium' }}</div>
        </div>
      </div>

      <!-- Footer -->
      <ng-template pTemplate = "footer">
        <div class = "flex justify-center">
          <p-button
            label = "Change Your Image"
            icon = "pi pi-pencil"
            styleClass = "p-button-outlined w-full p-button-lg"
            (onClick) = "displayImageChangeDialog = true"
          />
        </div>
      </ng-template>
    </p-card>
  </div>

  <!-- Dialog -->
  <p-dialog
    header = "Update Profile Picture"
    [(visible)] = "displayImageChangeDialog"
    [style] = "{ width: 'min(90vw, 40rem)' }"
    [modal] = "true"
    [draggable] = "false"
    [resizable] = "false"
    styleClass = "modern-upload-dialog"
  >
    <div class = "flex flex-col gap-6">
      <!-- Progress Bar -->
      <p-progressBar
        *ngIf = "uploading"
        [value] = "uploadProgress"
        [showValue] = "true"
        styleClass = "h-2"
      ></p-progressBar>

      <!-- Upload Section -->
      <div class = "card p-0">
        <p-fileUpload
          name = "profileImage"
          accept = "image/*"
          [multiple] = "false"
          [maxFileSize] = "4000000"
          (onSelect) = "onImageSelect($event)"
          (onClear) = "resetImageSelection()"
          [customUpload] = "true"
          chooseLabel = "Browse"
          uploadLabel = "Upload"
          cancelLabel = "Cancel"
          #fileUpload
        >
          <ng-template #header>
            <div class = "flex flex-wrap justify-between items-center w-full gap-4 p-4 border-b border-surface-border">
              <div class = "flex gap-3">
                <p-button
                  icon = "pi pi-images"
                  [rounded] = "true"
                  [outlined] = "true"
                  styleClass = "p-3"
                  (click) = "fileUpload?.choose()"
                />
                <p-button
                  icon = "pi pi-cloud-upload"
                  [rounded] = "true"
                  [outlined] = "true"
                  severity = "success"
                  styleClass = "p-3"
                  [disabled] = "!selectedImage || uploading"
                  (click) = "uploadImage()"
                />
                <p-button
                  icon = "pi pi-times"
                  [rounded] = "true"
                  [outlined] = "true"
                  severity = "danger"
                  styleClass = "p-3"
                  [disabled] = "!selectedImage || uploading"
                  (click) = "resetImageSelection()"
                />
              </div>
            </div>
          </ng-template>
          <ng-template #empty>
            <div class = "flex items-center justify-center flex-col py-8">
              <i class = "pi pi-cloud-upload border-2 border-surface-border rounded-full p-6 text-5xl text-color-secondary"></i>
              <p class = "mt-6 mb-0 text-color-secondary text-xl">Drag and drop image here or click to browse</p>
              <small class = "text-color-secondary mt-3 text-lg">JPG, PNG or GIF (Max 4MB)</small>
            </div>
          </ng-template>
        </p-fileUpload>
      </div>
    </div>
  </p-dialog>
</section>
